<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <style>
        body {
            background-color: darkslategray;
        }
    </style>
    <!--<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>-->
</head>
<body>
    <h1>Wikia Graphs</h1>
    <div id="mdw-cardsbycolor-chart"></div>
    <hr />
    <div id="mdw-manacurve-chart"></div>
    <div id="mdw-chartdata" style="display:none" data-chart="&#91;&#123;&quot;types&quot;:&#91;&quot;Instant&quot;],&quot;num&quot;:3,&quot;colors&quot;:&#91;&quot;Red&quot;],&quot;cmc&quot;:1},&#123;&quot;types&quot;:&#91;&quot;Instant&quot;],&quot;num&quot;:4,&quot;colors&quot;:&#91;&quot;Red&quot;],&quot;cmc&quot;:1},&#123;&quot;types&quot;:&#91;&quot;Creature&quot;],&quot;num&quot;:1,&quot;colors&quot;:&#91;&quot;Blue&quot;],&quot;cmc&quot;:2},&#123;&quot;types&quot;:&#91;&quot;Creature&quot;],&quot;num&quot;:1,&quot;colors&quot;:&#91;&quot;Blue&quot;],&quot;cmc&quot;:2},&#123;&quot;types&quot;:&#91;&quot;Creature&quot;],&quot;num&quot;:2,&quot;colors&quot;:&#91;&quot;Blue&quot;],&quot;cmc&quot;:2},&#123;&quot;types&quot;:&#91;&quot;Instant&quot;],&quot;num&quot;:1,&quot;colors&quot;:&#91;&quot;Blue&quot;],&quot;cmc&quot;:2},&#123;&quot;types&quot;:&#91;&quot;Sorcery&quot;],&quot;num&quot;:4,&quot;colors&quot;:&#91;&quot;Blue&quot;],&quot;cmc&quot;:2},&#123;&quot;types&quot;:&#91;&quot;Sorcery&quot;],&quot;num&quot;:4,&quot;colors&quot;:&#91;&quot;Red&quot;],&quot;cmc&quot;:2},&#123;&quot;types&quot;:&#91;&quot;Enchantment&quot;],&quot;num&quot;:1,&quot;colors&quot;:&#91;&quot;Blue&quot;],&quot;cmc&quot;:3},&#123;&quot;types&quot;:&#91;&quot;Enchantment&quot;],&quot;num&quot;:2,&quot;colors&quot;:&#91;&quot;Blue&quot;,&quot;Red&quot;],&quot;cmc&quot;:3},&#123;&quot;types&quot;:&#91;&quot;Enchantment&quot;],&quot;num&quot;:3,&quot;colors&quot;:&#91;&quot;Blue&quot;],&quot;cmc&quot;:3},&#123;&quot;types&quot;:&#91;&quot;Instant&quot;],&quot;num&quot;:4,&quot;colors&quot;:&#91;&quot;Red&quot;],&quot;cmc&quot;:3},&#123;&quot;types&quot;:&#91;&quot;Sorcery&quot;],&quot;num&quot;:2,&quot;colors&quot;:&#91;&quot;Red&quot;],&quot;cmc&quot;:3},&#123;&quot;types&quot;:&#91;&quot;Sorcery&quot;],&quot;num&quot;:2,&quot;colors&quot;:&#91;&quot;Blue&quot;],&quot;cmc&quot;:5},&#123;&quot;types&quot;:&#91;&quot;Sorcery&quot;],&quot;num&quot;:1,&quot;colors&quot;:&#91;&quot;Blue&quot;],&quot;cmc&quot;:5},&#123;&quot;types&quot;:&#91;&quot;Planeswalker&quot;],&quot;num&quot;:1,&quot;colors&quot;:&#91;&quot;Red&quot;],&quot;cmc&quot;:6},&#123;&quot;types&quot;:&#91;&quot;Creature&quot;],&quot;num&quot;:1,&quot;colors&quot;:&#91;&quot;Red&quot;],&quot;cmc&quot;:8},&#123;&quot;num&quot;:7,&quot;types&quot;:&#91;&quot;Land&quot;]},&#123;&quot;num&quot;:9,&quot;types&quot;:&#91;&quot;Land&quot;]},&#123;&quot;num&quot;:2,&quot;types&quot;:&#91;&quot;Land&quot;]},&#123;&quot;num&quot;:2,&quot;types&quot;:&#91;&quot;Land&quot;]},&#123;&quot;num&quot;:2,&quot;types&quot;:&#91;&quot;Land&quot;]},&#123;&quot;num&quot;:1,&quot;types&quot;:&#91;&quot;Land&quot;]}]"></div>
    <hr />
    <textarea id="jsondata" cols="40" rows="30"></textarea>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous">
    </script>
    <script>

        (function () {
            var dataString = $("#mdw-chartdata").attr("data-chart");
            var json = JSON.parse(dataString);
            var jsonString = JSON.stringify(json, null, 4);
            $("#jsondata").html(jsonString);
        })();

        // Start: graphs
        (function () {

            var chartDataId = "mdw-chartdata";
            var colorPieChartId = "mdw-cardsbycolor-chart";
            var manaCurveChartId = "mdw-manacurve-chart";

            function hasColorPieChart() {
                return document.getElementById(colorPieChartId) !== null;
            }

            function hasManaCurveChart() {
                return document.getElementById(manaCurveChartId) !== null;
            }

            function hasCharts() {
                if (document.getElementById(chartDataId) === null)
                    return false;
                return hasColorPieChart() || hasManaCurveChart();
            }

            function getChartData() {
                var dataString = document.getElementById(chartDataId).getAttribute("data-chart");
                return JSON.parse(dataString);
            }

            function adjustedColor(colors) {
                if (colors === undefined || colors.length === 0)
                    return "Colorless";
                if (colors.length > 1)
                    return "Multicolored";
                return colors[0];
            }

            function getColorData(cardData) {
                var colorData = [];
                cardData.forEach(function (card) {
                    if ($.inArray(card.types, "Land") === -1)
                        colorData.push([adjustedColor(card.colors), card.num]);
                });
                colorData.sort(function (a, b) {
                    return a[0].localeCompare(b[0]);
                });
                return colorData;
            }

            function sumByColor(data) {
                if (data.length === 0)
                    return data;
                var summedData = [];
                summedData.push(data[0]);
                for (var k = 1; k < data.length; k++) {
                    var lastIndex = summedData.length - 1;
                    if (data[k][0] === summedData[lastIndex][0])
                        summedData[lastIndex][1] += data[k][1];
                    else
                        summedData.push(data[k]);
                }
                return summedData;
            }


            function drawColorPieChart(chartData) {

                var dataColors = {
                    Red: 'red',
                    Green: 'green',
                    Blue: 'blue',
                    White: 'white',
                    Black: 'black',
                    Multicolored: 'pink',
                    Colorless: 'grey',
                };

                var sliceColors = [];
                chartData.forEach(function (e) {
                    sliceColors.push(dataColors[e[0]]);
                });

                var data = new google.visualization.DataTable();
                data.addColumn('string', 'Color');
                data.addColumn('number', 'Number');
                data.addRows(chartData);

                var options = {
                    title: "Color Distribution",
                    height: 240,
                    colors: sliceColors,
                    pieSliceText: 'value',
                    pieSliceBorderColor: "black",
                    pieSliceTextStyle: {
                        color: 'darkslategrey',
                        bold: true
                    },
                    chartArea: {
                        width: '100%',
                        height: '80%'
                    },
                    backgroundColor: {
                        fill: 'transparent'
                    },
                    legend: {
                        textStyle: {
                            color: 'black'
                        }
                    }
                };

                var chart = new google.visualization.PieChart(document.getElementById(colorPieChartId));
                chart.draw(data, options);
            }

            function drawManaCurveChart() {
                var data = [{
                    values: [19, 26, 55],
                    labels: ['Residential', 'Non-Residential', 'Utility'],
                    type: 'pie'
                }];

                var layout = {
                    height: 400,
                    width: 500
                };

                Plotly.newPlot('mdw-manacurve-chart', data, layout);
            }

            function colorPieChart(cardData) {
                var rawData = getColorData(cardData);
                var summedData = sumByColor(rawData);
                drawColorPieChart(summedData);
            }

            function manaCurveChart() {
                drawManaCurveChart();
            }

            function chartLibraryLoaded() {
                //var chartData = getChartData();
                //if (hasColorPieChart())
                //    colorPieChart(chartData);
                if (hasManaCurveChart())
                    manaCurveChart();
            }

            // do nothing for a page with no charts
            if (!hasCharts())
                return;

            jQuery.getScript('https://cdn.plot.ly/plotly-latest.min.js', chartLibraryLoaded);

        })();
        // End: graphs
    </script>
</body>
</html>